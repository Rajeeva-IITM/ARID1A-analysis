---
title: "Report - 19-8-24"
format: 
   typst:
     # toc: true
     fontsize: 12pt
     section-numbering: 1.1.1.
     columns: 1
     papersize: a4
     # css-property-processing: none
     margin: 
        x: 1in
        y: 1.25in
execute: 
  echo: false
  warning: false
  freeze: auto      
# prefer-html: true 
mainfont: CMU Serif
monofont: CMU Typewriter Text
tbl-cap-location: top
keep-typ: true
editor: visual
bibliography: references.bib
bibliographystyle: apa
---

```{=typst}
#show link: set text(fill: rgb(0, 0, 255))
#show link: underline
```
# Background

Two genes, ARID1A and STING, have been shown to affect the chemoresistance of cancer cells. ARID1A knockouts have been shown to be more sensitive to Volasertib treatment [@Srinivas_2022ARID1A]. Low STING expression has been shown to correlate with chemoresistance and poor survival rates. Dr. Anand Jeyashekaranâ€™s group has worked on these genes and they hypothesize that the activation of these genes creates a unique metabolic state in the cancer cell lines which in turn confer resistance to chemotherapy.

# Hypothesis

-   There is a difference in metabolism between the wild-type cells and ARID1A knockouts 
-   This difference makes ARID1A knockouts to be more susceptible to Volasertib treatment

<!-- # Tasks -->

<!-- -   Build Genome Scale Metabolic Models (GSMMs) that represent the cells from  -->

# Data availability

## RNA sequencing

*Note:* There was an error while downloading the RNASeq reads from the NUS data storage. Processed Transcripts per Million (TPM) data was instead downloaded from [NCBI](https://www.ncbi.nlm.nih.gov/geo/download/?type=rnaseq_counts&acc=GSE193942&format=file&file=GSE193942_norm_counts_TPM_GRCh38.p13_NCBI.tsv.gz). This data has been generated by NCBI using their built-in RNASeq analysis pipeline. Although this may not exactly represent the data used by the authors who submitted the data, it is a good starting point. The TPM data for the following conditions were available:

-   Cell line: GES1
    -   Wild Type
    -   ARID1A Knockout
    -   Wild Type with Volasertib treatment
    -   ARID1A Knockout with Volasertib treatment
-   Cell line: OVCAR3
    -   Wild Type
    -   ARID1A Knockout

## CRISPR knockout

In the same GEO Project, we have also the CRISPR screens. However this analysis is performed on MCF10 cancer cell line which does not have RNA sequencing information.

## Genome Scale Metabolic Model (GSMM)

Recon3D was the (GSMM) model from which the context specific models were built. This model contains 2248 genes, 5835 metabolites and 10600 reactions.

```{r}
#| label: prelims

library(ggplot2)
library(dplyr)
library(readr)
library(purrr)
library(tidyr)
```

# Methodology

All codes are available [here](https://github.com/Rajeeva-IITM/ARID1A-analysis).

## Building context-specific models

The expression data contained replicates of the different conditions. The replicates were averaged to obtain a single expression value per gene for a given condition. Context specific models were built using CobraToolBox [@Heirendt_2019CobraToolBox]. The thresholding algorithm used to convert the expression data to binary presence/absence data was LocalGini [@localgini_pavan]. Using this binary data and the Gene-Protein-Reaction (GPR) rules, the active genes were identified and their corresponding active reactions were extracted. But the resultant model may not be complete or consistent (having no blocked reactions). To overcome this, model extraction methods build the final context-specific model by adding a minimal set of reactions. Three main model extraction algorithms were chosen:

-   GIMME [@Becker_2008Gimme]
-   SprintCore (Unpublished work)
-   INIT [@Agren_2012init]

The biomass maintenance reaction was set as a core reaction (this reaction will be an active) in each of the model. The reason behind this choice was that one of the hallmarks of cancer is unbridled growth. Therefore, the resultant model should also be able to grow well.

<!-- *Note:* Media change was not performed because GES1 and OVCAR3 cells are of different origins (one is from cell culture and the other is a tumor from mice). Moreover, the medium that was used contained  -->

## Analysis

Firstly, the reactions that are differentially present between the different conditions were identified. Following this, Flux Enrichment Analysis (FEA) was performed to identify the reaction subsystems that are enriched in this set of reactions.

In the set of reactions that were common across all the cases, flux sampling was performed (OPTGP sampler) to understand the distribution of fluxes in the different conditions. Following this, differential reaction fluxes were identified based on two conditions:

-   A Kolmogorov-Smirnov test to check for the difference in distributions. The FDR adjusted p-value must be less than 0.05

-   The flux fold change [@Nanda2021] must be higher than 0.82 (corresponds to a 10 fold difference)

$$
\text{Flux Fold Change of Reaction}  = \frac{\bar{S}_{\text{condition 1}} - \bar{S}_{\text{condition 2}}}{    | \bar{S}_{\text{condition 1}} + \bar{S}_{\text{condition 2}} |} 
$$ {#eq-flux_fold_change}

where $\bar{S}$ refers to the mean flux through the particular reaction.

We focused on four main pairwise comparisons:

-   GES1 wild type: with and without Volasertib treatment, to understand the effects of the drug treatment on the metabolism of the cell

-   GES1 wild type and GES1 ARID1A knockout, to understand how the deletion of ARID1A changes the the cell metabolism

-   GES1 ARID1A knockout: with and without Volasertib treatment, to understand how ARID1A knockouts become more susceptible to the drug.

-   OVCAR3 wild type and ARID1A knockout, to understand how the deletion of ARID1A changes the the cell metabolism

{{<pagebreak>}}

# Results

## Results from Srinivas et al., 2022

![Growth of GES1 cell linem wild type and ARID1A knockouts on Volasertib treatment](images/clipboard-592237684.png){#fig-ges1 align="center"}

![Tumor size of OVCAR3 cell line in 2 combinations - ARID1A knockout and Volasertib treatment](images/clipboard-4784197.png){#fig-ovcar3 alighn="center"}

Few observations:

-   GES1 cell line: (@fig-ges1)
    -   ARID1A knockout has poorer growth than wild type (0nM concentration)
    -   Upon Volasertib treatment, ARID1A knockout cells are more vulnerable
    -   Under low concentrations of Volasertib (1nM), wild type cell lines show little difference in growth
-   OVCAR3 cell line: (@fig-ovcar3)
    -   ARID1A knockout has better growth (larger tumor size) than wild type
    -   ARID1A knockouts are more vulnerable to Volasertib treatment
    -   Little difference in growth for wild type cell lines upon Volasertib treatment

This will be used as a baseline over which the built GSMM models will be evaluated.

## Growth Analysis

### GIMME models

```{r}
#| label: fig-funcs
#| fig-cap: The optimal growth rate of the context-specific model built using GIMME. All the models have a very similar growth rate.


df <- read_csv("../../outputs/sampling_analysis/localgini_gimme_avg/growths.csv", col_types = "dddddd")

plot_growth <- function(df){
  df %>% 
    t %>% 
    as_tibble(rownames = "Conditions", .name_repair = \(x) "Growth flux") %>% 
    mutate(Conditions = replace(Conditions, Conditions=='GES_W1', 'GES1_WT')) %>% 
    ggplot(aes(x=Conditions, y=`Growth flux`)) + 
    geom_bar(stat = "identity") + 
    theme(axis.text.x = element_text(angle = 30, vjust=0.5))%>% 
    return()
}

plot_growth(df)
```

In @fig-funcs, we observe that models built by GIMME have a similar growth rate across the board. This is likely due to how GIMME works. GIMME adds the minimal number of reactions required to satisfy a metabolic function (which in this case, was growth). Therefore, in all models, reactions that support the growth must have been added by GIMME resulting in similar growths across the conditions. Due to these models not representing any growth differences observed in the experimental work, they were not used for further analysis.

{{< pagebreak >}}

### INIT Models

```{r}
#| label: fig-init-growth
#| fig-cap: Growths of the INIT built models

read_csv(
  "../../outputs/sampling_analysis/localgini_init_avg/growths.csv",
  col_types = "dddddd"
) %>% 
  plot_growth()
```

INIT models have produced some strange results that are contrary to experimental observation: (@fig-init-growth)

-   Wild type OVCAR3 cells grow better than ARID1A knockouts in the absence of Volasertib

-   GES1 ARID1A knockouts grow better than wild type cells in the absence of Volasertib

-   In the presence of Volasertib, GES1 ARID1A knockouts grow better than wild type which goes against the main findings of the paper

Due to these reasons, no further analysis was done with the INIT models.

{{< pagebreak >}}

### SprintCore Models

```{r}
#| label: fig-sprint-growth
#| fig-cap: Growths of the SprintCore built models

read_csv(
  "../../outputs/sampling_analysis/localgini_sprintcore_avg/growths.csv",
  col_types = "dddddd"
) %>% 
  plot_growth()
```

In @fig-sprint-growth, we observe that the growth rates are lower than the GIMME models. Moreover, we are able to observe some differences in growth values. OVCAR3-wildtype seems to be the fastest growing model. One interesting observation is the GES1-ARID1A knockout treated with Volasertib appears to grow slower than the wildtype treated with Volasertib. This was one of the main findings of Srinivas et al., 2022, i.e. ARID1A deficient cells are more vulnerable to Volasertib.

Observations:

-   OVCAR3 wild type grows better than ARID1A KO contrary to experimental observation

-   GES1 wild type grows better than ARID1A knockout in both presence and absence (very minute difference) of Volasertib

-   GES1 ARID1A knockouts grow better without Volasertib

Due to SprintCore being more representative than GIMME or INIT models, further analysis were performed on these.

<!-- {{< pagebreak >}} -->

## Reaction Analysis

The reactions that were unique to the given conditions were identified. Following this, the differential reactions were identified for the common reactions using @eq-flux_fold_change. All reported subsystems are statistically significant.

### GES1 wild type: with and without Volasertib treatment

```{r}
#| label: fig-comparison1-active
#| fig-cap: We identified the reactions that were more active upon Volasertib treatment compared to the wild-type GES1 cells. The subsystems for which the reactions were enriched were then identified.

source("../enrichment_analysis/flux_enrichment_analysis.R")
all_reactions <- read_csv("../../data/recon_reaction_names.csv", col_types="cf")

plot_fe_flux <- function(filename, title1, title2) {
  df <- read_csv(
  filename,
  col_types = "cdd"
) 
  p1 <- df %>% 
    filter(fc>0.82) %>% 
    pluck('Reaction') %>% 
    FEA(., all_reactions$Reaction, all_reactions$subSystem) %>% 
    filter(Adj_pval<0.05, Fold_change>0) %>% 
    ggplot(., aes(y=reorder(Group, Fold_change), x=Fold_change)) +
    geom_bar(stat = 'identity') +
    labs(y = 'Subsystem', title = title1, x="Fold Change")
  
  p2 <- df %>% 
  filter(fc< -0.82) %>% 
  pluck('Reaction') %>% 
  FEA(., all_reactions$Reaction, all_reactions$subSystem) %>% 
  filter(Adj_pval<0.05, Fold_change>0) %>% 
  ggplot(., aes(y=reorder(Group, Fold_change), x=Fold_change)) +
  geom_bar(stat = 'identity') +
  labs(y = 'Subsystem', title = title2, x="Fold Change")

  return(list(p1=p1,p2=p2))
}

plot_fe_flux(
  "../../outputs/sampling_analysis/localgini_sprintcore_avg/GES1_WT_Volasertib-GES_WT.csv",
  "GES1 WT",
  "GES1: WT+Volasertib"
) %>% pluck('p2')

```

**Observations**:

-   In @fig-comparison1-active:
    -   We observe that extracellular transport subsystem and exchange reactions are enriched for upregulated (higher flux compared to the control) reactions in the presence of Volasertib. This could imply that the cell is involved in pushing out the drug from the cell
    -   And it appears that the energy required to carry out these reactions are provided by the nucleotide intercoversion and mitochondrial transport pathways. There is also a small group of drug metabolising reactions upregulated
-   In @fig-comparison1-unique:
    -   Recapitulating previous findings, mitochondrial transport reactions and exchange reactions are uniquely enriched in Volasertib treated GES1 cells (@fig-comparison1-unique-2)
    -   Many pentose phosphate pathway reactions are unique to the Volasertib treated cells

```{r}
#| label: fig-comparison1-unique
#| fig-cap: "Comparing the unique reactions for GES1: WT and WT with Volasertib"
#| fig-subcap:
#|    - "Enriched subsystems of reactions unique to wild type GES1"
#|    - "Enriched subsystems of reactions unique to wild type GES1 with Volasertib"
#| layout-nrow: 2
  

fold_change <- \(enrich_size, query_size, total_set_size, universe_size=10600) {
  (enrich_size/query_size)/(total_set_size/universe_size)
}

comparisons_df <- read.csv("../../outputs/sampling_analysis/localgini_sprintcore_avg/unique_reactions.csv") %>% as.list()

total_reactions <- comparisons_df$GES1_WT_Volasertib_minus_GES_W1

plot_fe_unique <- function(filename, total_reactions, fig_title){
  df <- read_csv(filename, skip=1, col_types = "ddcii")
  df %>% 
    mutate(`Fold Change` = fold_change(`Enriched set size`, total_reactions, `Total set size`)) %>% 
    filter(`Adjusted P-value` < 0.05) %>% 
    ggplot(., aes(y=reorder(Group, `Fold Change`), x=`Fold Change`)) +
    geom_bar(stat = 'identity') +
    labs(y = 'Subsystem', title = fig_title) %>% 
    return()
}

plot_fe_unique(
  "../../outputs/sampling_analysis/localgini_sprintcore_avg/fea_results/GES1_WT_Volasertib_minus_GES_W1.csv",
  total_reactions,
  "GES1: WT - WT+Volasertib"
)

plot_fe_unique(
  "../../outputs/sampling_analysis/localgini_sprintcore_avg/fea_results/GES_W1_minus_GES1_WT_Volasertib.csv",
  comparisons_df$GES_W1_minus_GES1_WT_Volasertib,
  "GES1: WT+Volasertib - WT"
)
```

{{< pagebreak >}} 

### GES1 wild type and GES1 ARID1A knockout

```{r}
#| label: fig-comparison2-unique
#| fig-cap: "Comparing the unique reactions for GES1: WT and AIRD1A KO"
#| fig-subcap:
#| - "Enriched subsystems of reactions unique to wild type GES1 w.r.t. the ARID1A KO"
#| - Enriched subsystems of reactions unique to ARID1A KNO w.r.t. wild type GES1
#| layout-nrow: 2

plot_fe_unique(
  "../../outputs/sampling_analysis/localgini_sprintcore_avg/fea_results/GES1_ARID1A_KO_minus_GES_W1.csv",
  comparisons_df$GES1_ARID1A_KO_minus_GES_W1,
  "GES1: ARID1A_KO - WT"
)
plot_fe_unique(
  "../../outputs/sampling_analysis/localgini_sprintcore_avg/fea_results/GES_W1_minus_GES1_ARID1A_KO.csv",
  comparisons_df$GES_W1_minus_GES1_ARID1A_KO,
  "GES1: WT - ARID1A_KO"
)
```

```{r}
#| label: fig-comparison2-active
#| fig-cap: We identified the reactions that were more active in ARID1A knockouts compared to the wild-type GES1 cells. The subsystems for which the reactions were enriched were then identified.

plot_fe_flux(
  "../../outputs/sampling_analysis/localgini_sprintcore_avg/GES1_ARID1A_KO-GES_WT.csv",
  "ARID1A_KO - WT",
  "WT - ARID1A_KO"
) %>% pluck('p1')
```

**Observations:**

-   Drug metabolising and exchange reactions are more enriched in the wild-type compared to the ARID1A knockout, suggesting that the wild type can process the drug better (@fig-comparison2-unique)
-   Vitamin B6 and Steroid metabolism reactions are present in fewer numbers in the ARID1A knockout
-   Bile acid synthesis reactions are enriched but they are out of place because GES1 is a gastric epithelial cell line whereas bile acid is produced only in the liver

{{< pagebreak >}} 

### GES1 ARID1A knockout - with Volasertib

```{r}
#| label: fig-comparison3-unique
#| fig-cap: "Comparing the unique reactions for GES1: ARID1A KO and ARID1A KO with Volasertib"
#| fig-subcap:
#| - Enriched subsystems of reactions unique to wild type ARID1A KO w.r.t. the ARID1A KO with Volasertib
#| - Enriched subsystems of reactions unique to wild type ARID1A KO with Volasertib w.r.t. the ARID1A KO
#| layout-nrow: 2

plot_fe_unique(
  "../../outputs/sampling_analysis/localgini_sprintcore_avg/fea_results/GES1_ARID1A_KO_Volasertib_minus_GES1_ARID1A_KO.csv",
  comparisons_df$GES1_ARID1A_KO_Volasertib_minus_GES1_ARID1A_KO,
  "ARID1A_KO+Volasertib - ARID1A_KO"
)
plot_fe_unique(
  "../../outputs/sampling_analysis/localgini_sprintcore_avg/fea_results/GES1_ARID1A_KO_minus_GES1_ARID1A_KO_Volasertib.csv",
  comparisons_df$GES1_ARID1A_KO_minus_GES1_ARID1A_KO_Volasertib,
  "ARID1A_KO - ARID1A_KO+Volasertib"
)
```

```{r}
#| label: fig-comparison3-active
#| fig-cap: We identified the reactions that were more active upon Volasertib treatment compared to the GES1 ARID1A knockouts cells. The subsystems for which the reactions were enriched were then identified.

plot_fe_flux(
  "../../outputs/sampling_analysis/localgini_sprintcore_avg/GES1_ARID1A_KO_Volasertib-GES1_ARID1A_KO.csv",
  "ARID1A_KO+Volasertib - ARID1A_KO",
  "WT - ARID1A_KO"
) %>% pluck('p1')
```

**Observations:**

-   Exchange reactions are more prevalent in untreated ARID1A knockouts (@fig-comparison3-unique)
-   Vitamin B6 metabolism reactions seem to be enriched in Volasertib treated ARID1A knockouts but they were not enriched in untreated knockouts (@fig-comparison2-unique-2, @fig-comparison3-unique-2). 
-   Nucleotide interconversion reactions are more active in Volasertib treated ARID1A knockouts (@fig-comparison3-active)

{{< pagebreak >}} 

### OVCAR3: WT and ARID1A KO

```{r}
#| label: fig-comparison4-unique
#| fig-cap: "Comparing the unique reactions for OVCAR3: WT and ARID1A KO"
#| fig-subcap:
#| - Enriched subsystems of reactions unique to wild type OVCAR3 w.r.t. the ARID1A KO
#| - Enriched subsystems of reactions unique to wild type ARID1A KO w.r.t. the wild-type
#| layout-nrow: 2

plot_fe_unique(
  "../../outputs/sampling_analysis/localgini_sprintcore_avg/fea_results/OVCAR3_WT_minus_OVCAR3_ARID1A_KO.csv",
  comparisons_df$OVCAR3_WT_minus_OVCAR3_ARID1A_KO,
  "OVCAR3: WT - ARID1A_KO"
  
)
plot_fe_unique(
  "../../outputs/sampling_analysis/localgini_sprintcore_avg/fea_results/OVCAR3_ARID1A_KO_minus_OVCAR3_WT.csv",
  comparisons_df$GES_W1_minus_GES1_ARID1A_KO,
  "OVCAR3: ARID1A_KO - WT"
)
```

```{r}
#| label: fig-comparison4-active
#| fig-cap: We identified the reactions that were more active in ARID1A knockouts compared to the wild-type OVCAR3 cells. The subsystems for which the reactions were enriched were then identified.

plot_fe_flux(
  "../../outputs/sampling_analysis/localgini_sprintcore_avg/OVCAR3_ARID1A_KO-OVCAR3_WT.csv",
  "OVCAR3: ARID1A_KO - WT",
  "OVCAR3: WT - ARID1A_KO"
) %>% pluck('p1')
```

**Observations:**

-   Sugar metabolism reactions are enriched in the wild type compared to ARID1A knockouts (@fig-comparison4-unique-1). This could explain the observation in @fig-sprint-growth where the wild type OVCAR3 grows better than the ARID1A knockout
-   Conversely, nucleotide, lipid and amino acid metabolism reactions are more enriched in the ARID1A knockouts
-   Interestingly keratan suphate degradation and aliphatic amino acid metabolism are more active in ARID1A knockouts compared to the wild-type OVCAR3 strains (@fig-comparison4-active)


# Discussion

We built and characterized GSMMs to understand the effect of Volasertib treatment with a special focus on ARID1A gene which had been previously implicated in decreasing the resistance to the drug. We observed that wild type cells have more reactions enriched for drug metabolism compared to the ARID1A knockouts. Nucleotide interconversion appears to be an important reaction that is often upregulated in the conditions examined.

There appear to be some artifacts in the built models. Especially the presence of reactions that do not occur naturally in these cells, for instance, bile acid synthesis (@fig-comparison3-unique, @fig-comparison2-unique-1) or blood group synthesis @fig-comparison2-unique-1. These have to be ironed out before better insights can be obtained.

## Future Directions

-   Better method to evaluate the context-specific models
-   Consensus model building to create more representative models
-   Analysing the metabolic tasks of the built models to obtain greater insights
-   Modifying the code to be able to incorporate other -omics data
